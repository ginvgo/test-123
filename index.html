<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>极速记分器</title>
    <style>
        :root { --primary: #007bff; --danger: #ff4d4f; --success: #52c41a; --bg: #f4f7f9; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 12px; touch-action: manipulation; }
        .card { background: white; border-radius: 16px; padding: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 12px; }
        
        /* 顶部控制面板 */
        .top-panel { display: flex; flex-direction: column; gap: 10px; }
        .row { display: flex; gap: 8px; align-items: center; }
        input { border: 1px solid #ddd; border-radius: 8px; padding: 10px; font-size: 16px; outline: none; }
        
        /* 步长切换器 */
        .step-selector { display: flex; background: #eee; border-radius: 8px; padding: 3px; margin-top: 5px; }
        .step-btn { flex: 1; border: none; background: none; padding: 6px; font-size: 12px; border-radius: 6px; cursor: pointer; }
        .step-btn.active { background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-weight: bold; color: var(--primary); }

        /* 用户卡片 */
        .user-card { background: white; border-radius: 16px; margin-bottom: 15px; padding: 15px; border: 1px solid #eef; }
        .user-main { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
        
        /* 核心加减按钮 */
        .ctrl-btn { width: 50px; height: 50px; border-radius: 25px; border: none; font-size: 24px; font-weight: bold; color: white; display: flex; align-items: center; justify-content: center; active: opacity 0.6; }
        .btn-minus { background: var(--danger); box-shadow: 0 4px 0 #d9363e; }
        .btn-plus { background: var(--success); box-shadow: 0 4px 0 #389e0d; }
        .btn-minus:active, .btn-plus:active { transform: translateY(2px); box-shadow: 0 2px 0 #999; }

        .score-info { text-align: center; flex: 1; }
        .u-name { font-size: 1.2rem; font-weight: bold; display: block; margin-bottom: 2px; }
        .u-score { font-size: 1.8rem; font-weight: 800; color: var(--primary); }

        /* 底部明细 */
        .detail-row { display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #f0f0f0; pt: 10px; padding-top: 10px; }
        .logs { display: flex; gap: 4px; overflow-x: auto; flex: 1; margin-right: 10px; }
        .tag { font-size: 11px; padding: 2px 6px; border-radius: 4px; background: #f0f0f0; white-space: nowrap; }
        
        .btn-del { font-size: 12px; color: #999; background: none; border: none; padding: 0; }
    </style>
</head>
<body>

<div class="card top-panel">
    <div class="row">
        <input type="text" id="nameInp" style="flex:1" placeholder="输入成员姓名...">
        <button onclick="addUser()" style="background:var(--primary); color:white; border:none; padding:10px 20px; border-radius:8px; font-weight:bold;">添加</button>
    </div>
    <div class="row">
        <span style="font-size:14px; color:#666">单次点击加减量：</span>
        <div class="step-selector" id="stepSelector">
            <button class="step-btn active" onclick="setStep(1)">1</button>
            <button class="step-btn" onclick="setStep(5)">5</button>
            <button class="step-btn" onclick="setStep(10)">10</button>
            <button class="step-btn" onclick="setStep(20)">20</button>
        </div>
    </div>
    <div class="row" style="margin-top:5px; justify-content: space-between;">
        <span style="font-size:14px; color:#666">计算倍率: <input type="number" id="rateInp" value="1" style="width:50px; padding:4px;" oninput="render()"></span>
        <button onclick="resetAll()" style="color:var(--danger); background:none; border:none; font-size:13px;">清空整局记录</button>
    </div>
</div>

<div id="userList"></div>

<script>
    let users = JSON.parse(localStorage.getItem('speed_score_db')) || [];
    let currentStep = 1;

    function save() {
        localStorage.setItem('speed_score_db', JSON.stringify(users));
        render();
    }

    function setStep(s) {
        currentStep = s;
        const btns = document.querySelectorAll('.step-btn');
        btns.forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
    }

    function addUser() {
        const name = document.getElementById('nameInp').value.trim();
        if(!name) return;
        users.push({ id: Date.now(), name, score: 0, history: [] });
        document.getElementById('nameInp').value = '';
        save();
    }

    function mod(id, isPlus) {
        const user = users.find(u => u.id === id);
        if(!user) return;
        const val = isPlus ? currentStep : -currentStep;
        user.score += val;
        user.history.unshift({ val, time: new Date().toLocaleTimeString() });
        if(user.history.length > 8) user.history.pop();
        save();
    }

    function delUser(id) {
        if(confirm('删除该成员？')) {
            users = users.filter(u => u.id !== id);
            save();
        }
    }

    function resetAll() {
        if(confirm('确定要清空整局数据吗？')) {
            users = [];
            save();
        }
    }

    function render() {
        const rate = parseFloat(document.getElementById('rateInp').value) || 1;
        const container = document.getElementById('userList');
        container.innerHTML = users.map(u => `
            <div class="user-card">
                <div class="user-main">
                    <button class="ctrl-btn btn-minus" onclick="mod(${u.id}, false)">−</button>
                    <div class="score-info">
                        <span class="u-name">${u.name}</span>
                        <span class="u-score">${u.score}</span>
                        <div style="font-size:12px; color:var(--success)">结算: ${(u.score * rate).toFixed(1)}</div>
                    </div>
                    <button class="ctrl-btn btn-plus" onclick="mod(${u.id}, true)">＋</button>
                </div>
                <div class="detail-row">
                    <div class="logs">
                        ${u.history.map(h => `<span class="tag" style="color:${h.val>0?'var(--success)':'var(--danger)'}">${h.val>0?'+':''}${h.val}</span>`).join('')}
                    </div>
                    <button class="btn-del" onclick="delUser(${u.id})">删除</button>
                </div>
            </div>
        `).join('');
    }

    render();
</script>
</body>
</html>
