<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸“ä¸šè®°åˆ†ç»“ç®—ç³»ç»Ÿ</title>
    <style>
        :root { --primary: #1890ff; --danger: #ff4d4f; --success: #52c41a; --text: #262626; --bg: #f5f7fa; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 12px; color: var(--text); -webkit-user-select: none; }
        .card { background: white; border-radius: 16px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 12px; }
        
        /* é¡¶éƒ¨ç®¡ç† */
        .flex-row { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
        input { border: 1px solid #d9d9d9; border-radius: 8px; padding: 10px; font-size: 16px; outline: none; }
        .btn { border: none; border-radius: 8px; padding: 10px 16px; font-weight: bold; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }

        /* è‡ªå®šä¹‰æ­¥é•¿ */
        .step-box { background: #e6f7ff; border-radius: 8px; padding: 10px; margin-bottom: 15px; }
        .step-chips { display: flex; gap: 8px; margin-top: 8px; overflow-x: auto; }
        .chip { padding: 6px 15px; background: white; border: 1px solid var(--primary); color: var(--primary); border-radius: 20px; font-size: 14px; white-space: nowrap; }
        .chip.active { background: var(--primary); color: white; }

        /* ç”¨æˆ·ä¸“ä¸šå¡ç‰‡ */
        .user-card { background: white; border-radius: 16px; margin-bottom: 12px; padding: 15px; border: 1px solid #f0f0f0; }
        .user-header { display: flex; justify-content: space-between; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 10px; }
        .user-name { font-size: 1.1rem; font-weight: bold; color: #141414; }
        .user-score { font-size: 1.5rem; font-weight: 800; color: var(--primary); }

        .control-row { display: flex; justify-content: space-between; align-items: center; gap: 15px; }
        .main-btn { width: 60px; height: 60px; border-radius: 30px; border: none; font-size: 28px; color: white; display: flex; align-items: center; justify-content: center; transition: 0.1s; }
        .btn-sub { background: var(--danger); }
        .btn-add { background: var(--success); }
        .main-btn:active { transform: scale(0.9); opacity: 0.8; }

        /* ä¸“ä¸šè®°å½•å±•ç¤º */
        .history-list { font-size: 12px; color: #8c8c8c; height: 60px; overflow-y: auto; background: #fafafa; border-radius: 8px; padding: 5px 10px; margin-top: 10px; }
        .history-item { display: flex; justify-content: space-between; padding: 2px 0; border-bottom: 1px dashed #eee; }

        /* ç»“ç®—é¢æ¿ */
        .settle-bar { background: #1f1f1f; color: white; border-radius: 16px; padding: 20px; margin-top: 20px; }
        .settle-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 15px; }
        .win { color: var(--success); }
        .loss { color: var(--danger); }
    </style>
</head>
<body>

<div class="card">
    <div class="flex-row">
        <input type="text" id="nameInp" style="flex:1" placeholder="æˆå‘˜å§“å">
        <button class="btn btn-primary" onclick="addUser()">æ·»åŠ </button>
    </div>
    <div class="step-box">
        <div style="font-size:12px; color:#8c8c8c">å½“å‰åŠ å‡åˆ†æ•°å€¼ï¼š<span id="curStepTxt" style="color:var(--primary);font-weight:bold">10</span></div>
        <div class="step-chips" id="chips">
            <div class="chip active" onclick="setStep(10, this)">10</div>
            <div class="chip" onclick="setStep(20, this)">20</div>
            <div class="chip" onclick="setStep(50, this)">50</div>
            <div class="chip" onclick="setStep(100, this)">100</div>
            <input type="number" id="customStep" style="width:60px; padding:4px; font-size:12px;" placeholder="è‡ªå®šä¹‰" oninput="setCustomStep(this.value)">
        </div>
    </div>
</div>

<div id="userList"></div>

<div class="settle-bar">
    <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #434343; padding-bottom: 10px;">
        ğŸ ç»“ç®—ä¸­å¿ƒ
        <span style="font-size: 12px; font-weight: normal; float: right;">å€ç‡ï¼š<input type="number" id="rateInp" value="1" style="width:40px; background:#333; color:white; border:none; border-radius:4px; text-align:center;" oninput="render()"></span>
    </div>
    <div id="settleList"></div>
    <button onclick="resetAll()" style="width:100%; background:none; border:1px solid #434343; color:#8c8c8c; margin-top:15px; padding:8px; border-radius:8px;">æ¸…é™¤æ•°æ®é‡æ–°å¼€å±€</button>
</div>

<script>
    let users = JSON.parse(localStorage.getItem('pro_score_v3')) || [];
    let currentStep = 10;

    function save() {
        localStorage.setItem('pro_score_v3', JSON.stringify(users));
        render();
    }

    function setStep(val, el) {
        currentStep = parseFloat(val);
        document.getElementById('curStepTxt').innerText = currentStep;
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        if(el) el.classList.add('active');
    }

    function setCustomStep(val) {
        if(val) setStep(val, null);
    }

    function addUser() {
        const name = document.getElementById('nameInp').value.trim();
        if(!name) return;
        users.push({ id: Date.now(), name, score: 0, logs: [] });
        document.getElementById('nameInp').value = '';
        save();
    }

    function mod(id, type) {
        const user = users.find(u => u.id === id);
        const val = type === 'add' ? currentStep : -currentStep;
        user.score += val;
        user.logs.unshift({
            time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            val: (val > 0 ? '+' : '') + val
        });
        if(user.logs.length > 20) user.logs.pop();
        save();
    }

    function resetAll() {
        if(confirm('é‡ç½®å°†æ¸…ç©ºæ‰€æœ‰å†å²å’Œç»“ç®—æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ')) {
            users = [];
            save();
        }
    }

    function render() {
        const rate = parseFloat(document.getElementById('rateInp').value) || 1;
        
        // æ¸²æŸ“ä¸»åˆ—è¡¨
        document.getElementById('userList').innerHTML = users.map(u => `
            <div class="user-card">
                <div class="user-header">
                    <span class="user-name">${u.name}</span>
                    <span class="user-score">${u.score}</span>
                </div>
                <div class="control-row">
                    <button class="main-btn btn-sub" onclick="mod(${u.id}, 'sub')">ï¼</button>
                    <div style="flex:1; text-align:center; color:#8c8c8c; font-size:12px;">ç‚¹å‡»æŒ‰é’®åŠ å‡ ${currentStep}</div>
                    <button class="main-btn btn-add" onclick="mod(${u.id}, 'add')">ï¼‹</button>
                </div>
                <div class="history-list">
                    ${u.logs.map(l => `
                        <div class="history-item">
                            <span>${l.time} æ“ä½œè®°å½•</span>
                            <span style="color:${l.val.includes('+')?'var(--success)':'var(--danger)'}">${l.val}</span>
                        </div>
                    `).join('') || '<div style="text-align:center;padding-top:10px">æš‚æ— æµæ°´è®°å½•</div>'}
                </div>
            </div>
        `).join('');

        // æ¸²æŸ“ç»“ç®—
        document.getElementById('settleList').innerHTML = users.map(u => {
            const final = (u.score * rate).toFixed(2);
            return `
                <div class="settle-item">
                    <span>${u.name}</span>
                    <span class="${final >= 0 ? 'win' : 'loss'}">${final >= 0 ? 'ï¼‹' : ''}${final}</span>
                </div>
            `;
        }).join('') || '<div style="color:#434343">æš‚æ— ç»“ç®—æ•°æ®</div>';
    }

    render();
</script>
</body>
</html>
