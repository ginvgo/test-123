<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>明细记分助手</title>
    <style>
        :root { --primary: #007bff; --danger: #ff4d4f; --success: #52c41a; --bg: #f0f2f5; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 12px; }
        .card { background: white; border-radius: 12px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 12px; }
        
        /* 顶部配置 */
        .config-row { display: flex; gap: 10px; margin-bottom: 10px; }
        input { border: 1px solid #d9d9d9; border-radius: 6px; padding: 10px; font-size: 16px; outline: none; }
        .btn { border: none; border-radius: 6px; font-weight: bold; cursor: pointer; padding: 10px; }
        .btn-add { background: var(--primary); color: white; flex-shrink: 0; }

        /* 用户区块 */
        .user-card { border: 1px solid #f0f0f0; border-radius: 10px; margin-bottom: 15px; overflow: hidden; border-left: 5px solid var(--primary); }
        .user-header { background: #fafafa; padding: 12px; display: flex; justify-content: space-between; align-items: center; }
        .user-name { font-size: 1.1rem; font-weight: bold; }
        .user-total { text-align: right; }
        .total-num { font-size: 1.4rem; color: var(--primary); font-weight: 800; display: block; }
        .final-num { font-size: 0.85rem; color: var(--success); }

        /* 操作按钮 */
        .btn-group { display: grid; grid-template-columns: repeat(4, 1fr) 60px; gap: 5px; padding: 10px; background: white; }
        .btn-act { background: #f5f5f5; font-size: 13px; padding: 8px 0; border-radius: 4px; border: 1px solid #eee; }
        .btn-plus { color: var(--success); background: #f6ffed; border-color: #b7eb8f; }
        .btn-minus { color: var(--danger); background: #fff1f0; border-color: #ffa39e; }
        .inp-mini { width: 100%; box-sizing: border-box; text-align: center; padding: 6px; }

        /* 个人明细 */
        .user-logs { padding: 0 12px 10px; background: white; max-height: 80px; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 6px; }
        .log-tag { font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; background: #f0f0f0; color: #666; }
        .log-plus { background: #f6ffed; color: var(--success); }
        .log-minus { background: #fff1f0; color: var(--danger); }

        .btn-del-user { color: #ccc; font-size: 0.8rem; background: none; border: none; text-decoration: underline; }
    </style>
</head>
<body>

<div class="card">
    <div class="config-row">
        <input type="text" id="nameInp" style="flex:1" placeholder="新成员姓名">
        <button class="btn btn-add" onclick="addUser()">添加</button>
    </div>
    <div style="display:flex; align-items:center; font-size:14px; color:#666">
        倍率：<input type="number" id="rateInp" value="1" style="width:60px; margin-right:15px" oninput="render()">
        <button class="btn-del-user" onclick="resetAll()">清空整局</button>
    </div>
</div>

<div id="userList"></div>

<script>
    let users = JSON.parse(localStorage.getItem('clear_score_data')) || [];

    function save() {
        localStorage.setItem('clear_score_data', JSON.stringify(users));
        render();
    }

    function addUser() {
        const name = document.getElementById('nameInp').value.trim();
        if(!name) return;
        users.push({ id: Date.now(), name: name, score: 0, history: [] });
        document.getElementById('nameInp').value = '';
        save();
    }

    function modScore(userId, val) {
        const user = users.find(u => u.id === userId);
        if(!user) return;
        user.score += val;
        user.history.unshift({ val: val, time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) });
        if(user.history.length > 10) user.history.pop(); // 每个成员只显最近10条
        save();
    }

    function manualScore(userId) {
        const inp = document.getElementById(`inp-${userId}`);
        const val = parseFloat(inp.value);
        if(isNaN(val)) return;
        modScore(userId, val);
        inp.value = '';
    }

    function delUser(userId) {
        if(confirm('删除此人及其所有记录？')) {
            users = users.filter(u => u.id !== userId);
            save();
        }
    }

    function resetAll() {
        if(confirm('确定全部清空重新开始吗？')) {
            users = [];
            save();
        }
    }

    function render() {
        const rate = parseFloat(document.getElementById('rateInp').value) || 1;
        const container = document.getElementById('userList');
        container.innerHTML = users.map(u => `
            <div class="user-card">
                <div class="user-header">
                    <div>
                        <span class="user-name">${u.name}</span><br>
                        <button class="btn-del-user" onclick="delUser(${u.id})">删除成员</button>
                    </div>
                    <div class="user-total">
                        <span class="total-num">${u.score}</span>
                        <span class="final-num">最终: ${(u.score * rate).toFixed(1)}</span>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-act btn-minus" onclick="modScore(${u.id},-10)">-10</button>
                    <button class="btn btn-act btn-minus" onclick="modScore(${u.id},-1)">-1</button>
                    <button class="btn btn-act btn-plus" onclick="modScore(${u.id},1)">+1</button>
                    <button class="btn btn-act btn-plus" onclick="modScore(${u.id},10)">+10</button>
                    <input type="number" class="inp-mini" id="inp-${u.id}" placeholder="自定" onchange="manualScore(${u.id})">
                </div>

                <div class="user-logs">
                    ${u.history.length ? u.history.map(h => `
                        <span class="log-tag ${h.val > 0 ? 'log-plus' : 'log-minus'}">
                            ${h.val > 0 ? '+' : ''}${h.val}
                        </span>
                    `).join('') : '<span style="color:#ccc;font-size:12px">暂无明细</span>'}
                </div>
            </div>
        `).join('');
    }

    render();
</script>
</body>
</html>
