<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æŒä¹…è®°åˆ† Pro</title>
    <style>
        :root { --primary: #1890ff; --danger: #ff4d4f; --success: #52c41a; --text: #262626; --bg: #f2f4f7; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 12px; color: var(--text); overflow-x: hidden; }
        .card { background: white; border-radius: 16px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 12px; width: 100%; }
        
        /* é¡¶éƒ¨ */
        .header-group { display: flex; gap: 8px; }
        .inp-name { flex: 1; border: 1px solid #d9d9d9; border-radius: 10px; padding: 10px; font-size: 16px; min-width: 0; }
        .btn-add { background: var(--primary); color: white; border: none; border-radius: 10px; padding: 0 16px; font-weight: bold; white-space: nowrap; }
        
        /* å€ç‡ */
        .rate-box { display: flex; align-items: center; gap: 8px; margin-top: 12px; font-size: 14px; color: #666; }
        .inp-rate { width: 60px; border: 1px solid #d9d9d9; border-radius: 6px; padding: 4px; text-align: center; font-size: 14px; }

        /* å¡ç‰‡ */
        .user-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; border: 1px solid #f0f0f0; }
        .user-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .u-name { font-size: 1.1rem; font-weight: bold; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .btn-del { border: none; background: none; color: #bfbfbf; font-size: 12px; padding: 0; margin-top: 4px; text-decoration: underline; }
        .u-score { font-size: 1.8rem; font-weight: 800; color: var(--primary); }

        /* æ“ä½œæ  */
        .control-bar { display: flex; align-items: center; gap: 10px; width: 100%; }
        .btn-main { width: 60px; height: 50px; border: none; border-radius: 12px; font-size: 24px; color: white; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .btn-sub { background: var(--danger); box-shadow: 0 3px 0 #cf1322; }
        .btn-plus { background: var(--success); box-shadow: 0 3px 0 #389e0d; }
        .btn-main:active { transform: translateY(2px); box-shadow: none; }
        .val-input { flex: 1; min-width: 0; height: 50px; font-size: 20px; font-weight: bold; border: 2px solid #f0f0f0; background: #fafafa; border-radius: 12px; text-align: center; }

        /* å†å² */
        .hist-toggle { display: block; text-align: center; font-size: 13px; color: #bfbfbf; padding: 10px 0 0; text-decoration: none; }
        .hist-content { display: none; background: #fafafa; border-radius: 10px; padding: 10px; margin-top: 10px; max-height: 120px; overflow-y: auto; }
        .hist-item { display: flex; justify-content: space-between; font-size: 12px; padding: 4px 0; border-bottom: 1px dashed #eee; }

        /* ç»“ç®— */
        .settle-area { background: #1a1a1a; color: #fff; border-radius: 20px; padding: 20px; margin-top: 20px; margin-bottom: 30px; }
        .settle-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .settle-row { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .win { color: var(--success); }
        .loss { color: var(--danger); }
        .btn-reset { width: 100%; background: none; border: 1px solid #444; color: #888; border-radius: 10px; padding: 12px; margin-top: 10px; font-size: 14px; }
    </style>
</head>
<body>

<div class="card">
    <div class="header-group">
        <input type="text" id="nameInp" class="inp-name" placeholder="è¾“å…¥æˆå‘˜å§“å...">
        <button class="btn-add" onclick="addUser()">æ·»åŠ </button>
    </div>
    <div class="rate-box">
        ç»“ç®—å€ç‡ï¼š<input type="number" id="rateInp" class="inp-rate" value="1">
    </div>
</div>

<div id="userList"></div>

<div class="settle-area">
    <div class="settle-title">ğŸ æœ€ç»ˆç»“ç®— (å€ç‡å)</div>
    <div id="settleList"></div>
    <button class="btn-reset" onclick="resetAll()">æ¸…ç©ºæ‰€æœ‰è®°å½• (é‡ç½®æ–°ä¸€å±€)</button>
</div>

<script>
    // åˆå§‹åŒ–ï¼šä¼˜å…ˆä»æœ¬åœ°å­˜å‚¨è¯»å–
    let state = JSON.parse(localStorage.getItem('ScoreTool_Data')) || {
        users: [],
        rate: 1
    };

    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    function syncStorage() {
        localStorage.setItem('ScoreTool_Data', JSON.stringify(state));
        render();
    }

    function addUser() {
        const name = document.getElementById('nameInp').value.trim();
        if(!name) return;
        state.users.push({ id: Date.now(), name, score: 0, logs: [], lastVal: 10 });
        document.getElementById('nameInp').value = '';
        syncStorage();
    }

    function mod(id, isAdd) {
        const user = state.users.find(u => u.id === id);
        const val = parseFloat(document.getElementById(`inp-${id}`).value) || 0;
        user.lastVal = val;
        const change = isAdd ? val : -val;
        user.score += change;
        user.logs.unshift({
            time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            val: (change > 0 ? '+' : '') + change
        });
        syncStorage();
    }

    function delUser(id) {
        if(confirm('ç¡®å®šåˆ é™¤è¯¥æˆå‘˜å—ï¼Ÿ')) {
            state.users = state.users.filter(u => u.id !== id);
            syncStorage();
        }
    }

    function resetAll() {
        if(confirm('å°†æ¸…ç©ºæ‰€æœ‰äººçš„åˆ†æ•°å’Œè®°å½•ï¼Œç¡®å®šå—ï¼Ÿ')) {
            state = { users: [], rate: 1 };
            syncStorage();
        }
    }

    // ç›‘å¬å€ç‡å˜åŒ–
    document.getElementById('rateInp').addEventListener('input', (e) => {
        state.rate = parseFloat(e.target.value) || 1;
        syncStorage();
    });

    function toggleHist(id) {
        const content = document.getElementById(`content-${id}`);
        const link = document.getElementById(`link-${id}`);
        const isHidden = content.style.display === '' || content.style.display === 'none';
        content.style.display = isHidden ? 'block' : 'none';
        link.innerText = isHidden ? 'â–² æ”¶èµ·æ˜ç»†' : 'â–¼ æŸ¥çœ‹æ“ä½œæ˜ç»†';
    }

    function render() {
        document.getElementById('rateInp').value = state.rate;
        
        // æ¸²æŸ“åˆ—è¡¨
        document.getElementById('userList').innerHTML = state.users.map(u => `
            <div class="user-card">
                <div class="user-header">
                    <div>
                        <span class="u-name">${u.name}</span>
                        <button class="btn-del" onclick="delUser(${u.id})">åˆ é™¤æˆå‘˜</button>
                    </div>
                    <div class="u-score">${u.score}</div>
                </div>
                <div class="control-bar">
                    <button class="btn-main btn-sub" onclick="mod(${u.id}, false)">âˆ’</button>
                    <input type="number" class="val-input" id="inp-${u.id}" value="${u.lastVal}" onchange="saveVal(${u.id}, this.value)">
                    <button class="btn-main btn-plus" onclick="mod(${u.id}, true)">ï¼‹</button>
                </div>
                <a href="javascript:void(0)" class="hist-toggle" id="link-${u.id}" onclick="toggleHist(${u.id})">â–¼ æŸ¥çœ‹æ“ä½œæ˜ç»†</a>
                <div class="hist-content" id="content-${u.id}">
                    ${u.logs.map(l => `<div class="hist-item"><span>${l.time}</span><span class="${l.val.includes('+')?'win':'loss'}">${l.val}</span></div>`).join('') || '<div style="text-align:center;color:#ccc">æš‚æ— è®°å½•</div>'}
                </div>
            </div>
        `).join('');

        // æ¸²æŸ“ç»“ç®—
        document.getElementById('settleList').innerHTML = state.users.map(u => {
            const final = (u.score * state.rate).toFixed(1);
            return `<div class="settle-row"><span>${u.name}</span><span class="${final >= 0 ? 'win' : 'loss'}">${final >= 0 ? '+' : ''}${final}</span></div>`;
        }).join('') || '<div style="color:#666">åˆ—è¡¨ä¸ºç©º</div>';
    }

    function saveVal(id, val) {
        const user = state.users.find(u => u.id === id);
        if(user) {
            user.lastVal = parseFloat(val) || 0;
            localStorage.setItem('ScoreTool_Data', JSON.stringify(state));
        }
    }

    render();
</script>
</body>
</html>
